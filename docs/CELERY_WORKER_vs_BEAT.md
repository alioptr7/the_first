# Celery Worker vs Beat - ØªÙˆØ¶ÛŒØ­ Ø¬Ø§Ù…Ø¹

## ğŸ¯ Ø¯Ùˆ Ù†Ù‚Ø´ Ù…ØªÙØ§ÙˆØª

### **1ï¸âƒ£ Worker (Ú©Ø§Ø±Ú¯Ø±)**
```
Ø¯Ø³ØªÙˆØ±: celery -A workers.celery_app worker --loglevel=info
```

**Ù†Ù‚Ø´:** Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø¯Ù‡

```
Redis Queue
    â”œâ”€ export_settings
    â”œâ”€ export_results
    â””â”€ cache_maintenance

        â†“ (Worker Ø§ÛŒÙ†Ù‡Ø§ Ø±Ø§ Ù…ÛŒØ®ÙˆØ§Ù†Ø¯)

Worker (Process Ú©Ù†Ù†Ø¯Ù‡)
    â”œâ”€ export_settings âœ… Ø§Ù†Ø¬Ø§Ù…
    â”œâ”€ export_results âœ… Ø§Ù†Ø¬Ø§Ù…
    â””â”€ cache_maintenance âœ… Ø§Ù†Ø¬Ø§Ù…
```

**ÙˆØ¸ÛŒÙÙ‡:** Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Queue Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†Ø¯

---

### **2ï¸âƒ£ Beat (Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²)**
```
Ø¯Ø³ØªÙˆØ±: celery -A workers.celery_app beat --loglevel=info
```

**Ù†Ù‚Ø´:** Ø§ÛŒØ¬Ø§Ø¯ ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø¯Ù‡ **Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…Ø§Ù†**

```
Celery Beat Scheduler (Ø³Ø§Ø¹Øª)
    â”‚
    â”œâ”€ Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡: export_settings Ø±Ø§ Queue Ù…ÛŒÙØ±Ø³ØªØ¯
    â”œâ”€ Ù‡Ø± 120 Ø«Ø§Ù†ÛŒÙ‡: export_results Ø±Ø§ Queue Ù…ÛŒÙØ±Ø³ØªØ¯
    â”œâ”€ Ù‡Ø± 300 Ø«Ø§Ù†ÛŒÙ‡: system_monitoring Ø±Ø§ Queue Ù…ÛŒÙØ±Ø³ØªØ¯
    â””â”€ Ù‡Ø± 3600 Ø«Ø§Ù†ÛŒÙ‡: cache_maintenance Ø±Ø§ Queue Ù…ÛŒÙØ±Ø³ØªØ¯

        â†“ (Ù…ÛŒÙØ±Ø³ØªØ¯ Ø¨Ø±Ø§ÛŒ)

Redis Queue
    â”œâ”€ export_settings
    â”œâ”€ export_results
    â””â”€ ...
```

**ÙˆØ¸ÛŒÙÙ‡:** Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ²Ù…Ø§Ù†ÛŒ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ø¯ Ùˆ ØªØ³Ú©â€ŒÙ‡Ø§ Ø±Ø§ Queue Ù…ÛŒÙØ±Ø³ØªØ¯

---

## ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡

| ÙˆÛŒÚ˜Ú¯ÛŒ | Worker | Beat |
|--------|--------|------|
| **Ù†Ù‚Ø´** | Ø§Ø¬Ø±Ø§Ú©Ù†Ù†Ø¯Ù‡ | Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ² |
| **Ú©Ø§Ø±** | Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Ú©â€ŒÙ‡Ø§ | Ø§ÛŒØ¬Ø§Ø¯ ØªØ³Ú©â€ŒÙ‡Ø§ |
| **Ù…Ù†ØªØ¸Ø± Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯** | ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Queue | Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ù‚Ø±Ø±Ø§Øª |
| **Ú†Ù†Ø¯â€ŒØ¨Ø§Ø± Ø§Ø¬Ø±Ø§** | âœ… Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ú†Ù†Ø¯ instance | âŒ ÙÙ‚Ø· ÛŒÚ© Beat |
| **Ø§Ù„Ø²Ø§Ù…** | âœ… Ø¶Ø±ÙˆØ±ÛŒ | âš ï¸ Ø¨Ø±Ø§ÛŒ ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ scheduled |

---

## ğŸ”„ ÙÙ„Ùˆ Ú©Ø§Ù…Ù„ (Ø¨Ø§ Ù‡Ø± Ø¯Ùˆ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Celery Beat (Scheduler)         â”‚
â”‚ [Ø´Ø±ÙˆØ¹ Ø´Ø¯ - Ù…Ù†ØªØ¸Ø± Ø³Ø§Ø¹Øª]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ø¯Ø± Ø³Ø§Ø¹Øª 14:30:00:               â”‚
â”‚ "export_settings Ø¨Ø§ÛŒØ¯ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Queue                      â”‚
â”‚ messages: [                      â”‚
â”‚   {task: export_settings}        â”‚
â”‚ ]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Celery Worker 1 (ÙØ§Ø±Øº)          â”‚
â”‚ âœ… ØªØ³Ú© Ø±Ø§ Ù…ÛŒÚ¯ÛŒØ±Ø¯                 â”‚
â”‚ â†’ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ export_settings    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            (Ù‡Ù…Ø²Ù…Ø§Ù†)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Celery Beat (Ù…Ù†ØªØ¸Ø± Ø¨Ø¹Ø¯ÛŒ)       â”‚
â”‚ Ø¯Ø± Ø³Ø§Ø¹Øª 14:31:00:               â”‚
â”‚ "export_results Ø¨Ø§ÛŒØ¯ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Queue                      â”‚
â”‚ messages: [                      â”‚
â”‚   {task: export_results}         â”‚
â”‚ ]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Celery Worker 2 (ÙØ§Ø±Øº)          â”‚
â”‚ âœ… ØªØ³Ú© Ø±Ø§ Ù…ÛŒÚ¯ÛŒØ±Ø¯                 â”‚
â”‚ â†’ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ export_results     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Response Network

### **Beat Schedule (workers/celery_app.py):**
```python
celery_app.conf.beat_schedule = {
    "export-settings-every-minute": {
        "task": "workers.tasks.settings_exporter.export_settings_to_request_network",
        "schedule": 60.0,  # Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡
    },
    "export-results-every-2-minutes": {
        "task": "workers.tasks.export_results.export_completed_results",
        "schedule": 120.0,  # Ù‡Ø± 120 Ø«Ø§Ù†ÛŒÙ‡
    },
}
```

---

## ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØµØ­ÛŒØ­

### **Ø¨Ø±Ø§ÛŒ Response Network:**

```powershell
# Terminal 1: Beat (ÛŒÚ© Ø¨Ø§Ø± ÙÙ‚Ø·!)
cd c:\Users\win\the_first\response-network\api
celery -A workers.celery_app beat --loglevel=info

# Terminal 2: Worker (Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú†Ù†Ø¯ Ø¨Ø§Ø±)
cd c:\Users\win\the_first\response-network\api
celery -A workers.celery_app worker --loglevel=info --concurrency=4
```

### **Ø¨Ø±Ø§ÛŒ Request Network:**

```powershell
# ÙÙ‚Ø· Worker (Ø¨Ø¯ÙˆÙ† Beat!)
cd c:\Users\win\the_first\request-network\api
celery -A workers.celery_app worker --loglevel=info --concurrency=4
```

---

## âš ï¸ Ø§Ú¯Ø± ÙÙ‚Ø· ÛŒÚ©ÛŒ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯:

### **ØµØ±ÙØ§Ù‹ Worker (Ø¨Ø¯ÙˆÙ† Beat):**
```
âŒ ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Scheduled Ø§Ø¬Ø±Ø§ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
âœ… ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Manual/API Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
```

Ù…Ø«Ø§Ù„:
```python
# âœ… Ø§ÛŒÙ† Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (manual task)
from workers.tasks.settings_exporter import export_settings_to_request_network
export_settings_to_request_network.delay()

# âŒ Ø§ÛŒÙ† Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (scheduled - Ù†ÛŒØ§Ø² Ø¨Ù‡ Beat)
# Beat Ù†Ù…ÛŒâ€ŒÙØ±Ø³ØªØ¯ Ù‡Ø± 60 Ø«Ø§Ù†ÛŒÙ‡!
```

### **ØµØ±ÙØ§Ù‹ Beat (Ø¨Ø¯ÙˆÙ† Worker):**
```
âœ… Beat ØªØ³Ú©â€ŒÙ‡Ø§ Ø±Ø§ Ù…ÛŒÙØ±Ø³ØªØ¯
âŒ Ú©Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ù†ÛŒØ³Øª!
â³ ØªØ³Ú©â€ŒÙ‡Ø§ Queue Ù…ÛŒØ´ÙˆÙ†Ø¯ Ø¨ÛŒâ€ŒØ§Ù†Ø¬Ø§Ù…
```

Ø®Ø±ÙˆØ¬ÛŒ Beat:
```
[2025-11-12 14:30:00] Scheduler: Sending due task 
    export_settings_to_request_network
[2025-11-12 14:30:05] (Task waiting in queue... no worker!)
```

---

## ğŸ“‹ Ø¨Ø±Ø±Ø³ÛŒ

### **Ú†Ú¯ÙˆÙ†Ù‡ Ø¨Ø¯Ø§Ù†ÛŒÙ… Worker ÙØ¹Ø§Ù„ Ø§Ø³ØªØŸ**
```bash
# Ø¯Ø± Terminal Ø¬Ø¯ÛŒØ¯
celery -A workers.celery_app inspect active
# Ù†ØªÛŒØ¬Ù‡: [{worker_name: ['task1', 'task2', ...]}]
```

### **Ú†Ú¯ÙˆÙ†Ù‡ Ø¨Ø¯Ø§Ù†ÛŒÙ… Beat ÙØ¹Ø§Ù„ Ø§Ø³ØªØŸ**
```bash
# Ø¨Ø±Ø±Ø³ÛŒ log Beat
# [2025-11-12 14:30:00] Scheduler: Sending due task...
```

### **Queue Ú©Ø¬Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ**
```
Redis: localhost:6380/0
Keys in Redis:
  - celery (default queue)
  - tasks data
```

---

## âœ… Ø®Ù„Ø§ØµÙ‡

| Ø¹Ù†ØµØ± | Ù†Ù‚Ø´ | Ø§Ù„Ø²Ø§Ù… |
|------|-----|-------|
| **Worker** | Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Ú©â€ŒÙ‡Ø§ | âœ… Ø¶Ø±ÙˆØ±ÛŒ |
| **Beat** | Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ²Ù…Ø§Ù†ÛŒ | âš ï¸ Ø¨Ø±Ø§ÛŒ scheduled tasks |
| **Redis** | Queue/Broker | âœ… Ø¶Ø±ÙˆØ±ÛŒ |

**Ø¨Ø±Ø§ÛŒ Response Network:**
- Worker âœ… (Ø§Ø¬Ø±Ø§ Ú©Ù†)
- Beat âœ… (Ø§Ø¬Ø±Ø§ Ú©Ù†)
- Redis âœ… (Docker Ù…ÛŒØ¯Ù‡Ø¯)

**Ø¨Ø±Ø§ÛŒ Request Network:**
- Worker âœ… (Ø§Ø¬Ø±Ø§ Ú©Ù†)
- Beat âŒ (Ù†ÛŒØ³Øª! reactive Ø§Ø³Øª)

